<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SEPHIROTH_V8.1 // STABLE BROADCAST</title>

<link rel="icon" href="data:,">

<style>
body{margin:0;background:black;color:white;font-family:Courier New;overflow:hidden}
canvas{width:100vw;height:100vh;background:black}
#overlay{
position:absolute;width:100%;height:100%;
background:black;display:flex;flex-direction:column;
justify-content:center;align-items:center;z-index:10}
button{
padding:20px 50px;background:black;color:white;
border:1px solid white;letter-spacing:4px;cursor:pointer}
#progress{
position:absolute;bottom:0;height:4px;background:red;width:0%}
</style>
</head>
<body>

<div id="overlay">
<h2>DEPARTMENT OF ETHEREAL SAFETY</h2>
<p>COGNITIVE HAZARD TAPE</p>
<button onclick="start()">BEGIN RECOVERY</button>
</div>

<canvas id="c" width="1280" height="720"></canvas>
<div id="progress"></div>

<script>

//////////////////////////////////////////////////////////
// MASSIVE BRAIN
//////////////////////////////////////////////////////////

function generateKeyword(){
const baseWords=[
"memory","surveillance","dream","signal","void","neural",
"hypnosis","perception","psyops","archive","cognition",
"frequency","delta","gamma","shadow","protocol"
];

let word=baseWords[Math.floor(Math.random()*baseWords.length)];

for(let i=0;i<3;i++){
word+=Math.floor(Math.random()*9999);
}

return word;
}

const BRAIN={
keyword:generateKeyword(),
danger:Math.random(),
mood:Math.random()
};

//////////////////////////////////////////////////////////

const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");

let audioCtx;
let mediaDest;
let recorder;
let chunks=[];
let frame=0;
let running=false;

let scrapedTexts=[];
let scrapedImages=[];

//////////////////////////////////////////////////////////
// SAFE SCRAPING
//////////////////////////////////////////////////////////

async function scrapeText(){

scrapedTexts=[];

try{
const res=await fetch(
"https://en.wikipedia.org/api/rest_v1/page/summary/"+BRAIN.keyword
);

if(res.ok){
const data=await res.json();
if(data.extract) scrapedTexts.push(data.extract);
}
}catch{}

if(scrapedTexts.length===0){

try{
const res=await fetch(
"https://en.wikipedia.org/api/rest_v1/page/random/summary"
);
const data=await res.json();
if(data.extract) scrapedTexts.push(data.extract);
}catch{}
}

}

function scrapeImage(){

scrapedImages=[];

const img=new Image();

img.crossOrigin="anonymous";

img.onload=()=>scrapedImages.push(img);

img.onerror=()=>console.log("Image failed safely");

img.src="https://picsum.photos/800/600?random="+Math.random();

}

//////////////////////////////////////////////////////////
// AUDIO (Guaranteed recording)
//////////////////////////////////////////////////////////

function setupAudio(){

audioCtx=new AudioContext();
mediaDest=audioCtx.createMediaStreamDestination();

const master=audioCtx.createGain();
master.connect(mediaDest);
master.connect(audioCtx.destination);

const drone=audioCtx.createOscillator();
drone.frequency.value=40+(BRAIN.mood*40);

const droneGain=audioCtx.createGain();
droneGain.gain.value=0.2;

drone.connect(droneGain);
droneGain.connect(master);
drone.start();

return mediaDest.stream;

}

function glitchSound(){

const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();

osc.frequency.value=500+(Math.random()*2000);
gain.gain.value=.8;

osc.connect(gain);
gain.connect(mediaDest);
gain.connect(audioCtx.destination);

osc.start();
osc.stop(audioCtx.currentTime+.2);

}

//////////////////////////////////////////////////////////
// VISUALS
//////////////////////////////////////////////////////////

function drawPSA(){

ctx.fillStyle="#000020";
ctx.fillRect(0,0,1280,720);

ctx.strokeStyle="white";
ctx.strokeRect(50,50,1180,620);

ctx.font="40px Courier New";
ctx.fillText("EMERGENCY BROADCAST SYSTEM",80,120);

ctx.font="20px Courier New";

let y=200;

for(let text of scrapedTexts){
wrap(text,80,y,1000,28);
y+=150;
}

for(let img of scrapedImages){

if(img.complete && img.naturalWidth>0){
ctx.globalAlpha=.4;
ctx.drawImage(img,700,250,450,300);
ctx.globalAlpha=1;
}

}

drawOverlay();

drawScanlines();

}

function drawOverlay(){

ctx.font="14px Courier New";

ctx.fillText("KEYWORD: "+BRAIN.keyword,80,680);
ctx.fillText("FRAME: "+frame,300,680);
ctx.fillText("INTEGRITY: "+Math.floor(Math.random()*100)+"%",500,680);

}

function drawScanlines(){
ctx.globalAlpha=.2;
for(let y=0;y<720;y+=4)
ctx.fillRect(0,y,1280,2);
ctx.globalAlpha=1;
}

function drawEntity(){

ctx.fillStyle="white";
ctx.fillRect(0,0,1280,720);

ctx.fillStyle="black";
ctx.font="100px Courier New";
ctx.fillText("THE FIEND",250,360);

}

//////////////////////////////////////////////////////////

function wrap(text,x,y,max,lineHeight){
const words=text.split(" ");
let line="";
for(let w of words){
const test=line+w+" ";
if(ctx.measureText(test).width>max){
ctx.fillText(line,x,y);
line=w+" ";
y+=lineHeight;
}else line=test;
}
ctx.fillText(line,x,y);
}

//////////////////////////////////////////////////////////

function loop(){

if(!running)return;

frame++;

document.getElementById("progress").style.width=
(frame/3000*100)+"%";

if(Math.random()>.995){
glitchSound();
drawEntity();
}else{
drawPSA();
}

if(frame<3000)
requestAnimationFrame(loop);
else stop();

}

//////////////////////////////////////////////////////////

async function start(){

document.getElementById("overlay").style.display="none";

await scrapeText();
scrapeImage();

const audio=setupAudio();
const canvasStream=canvas.captureStream(60);

const combined=new MediaStream([
...canvasStream.getVideoTracks(),
...audio.getAudioTracks()
]);

recorder=new MediaRecorder(combined);

chunks=[];

recorder.ondataavailable=e=>{
if(e.data.size>0)chunks.push(e.data);
};

recorder.onstop=save;

recorder.start();

running=true;

loop();

}

function stop(){
running=false;
recorder.stop();
}

function save(){

const blob=new Blob(chunks,{type:"video/webm"});
const url=URL.createObjectURL(blob);

const a=document.createElement("a");
a.href=url;
a.download="SEPHIROTH_V8_STABLE_"+BRAIN.keyword+".webm";
a.click();

}

</script>
</body>
</html>


