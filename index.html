<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SEPHIROTH_V7 // ENTROPY BROADCAST</title>

<style>
body{margin:0;background:black;color:white;font-family:Courier New;overflow:hidden}
canvas{width:100vw;height:100vh}
#overlay{
position:absolute;
width:100%;height:100%;
display:flex;flex-direction:column;
justify-content:center;align-items:center;
background:black;z-index:10}
button{
padding:20px 40px;
background:black;color:white;
border:1px solid white;
letter-spacing:4px;cursor:pointer}
#progress{
position:absolute;bottom:0;height:4px;
background:red;width:0%}
</style>
</head>
<body>

<div id="overlay">
<h2>DEPARTMENT OF ETHEREAL SAFETY</h2>
<p>CHANNEL 88 â€” SIGNAL RECOVERY NODE</p>
<button onclick="start()">INITIATE DECODING</button>
</div>

<canvas id="c" width="1280" height="720"></canvas>
<div id="progress"></div>

<script>

const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");

let audioCtx;
let mediaDest;
let recorder;
let chunks=[];
let frame=0;
let running=false;
let scrapedText="";
let scrapedImage=new Image();
let glitch=false;
let signalID=Math.random().toString(16).slice(2);
let chapter=0;

//////////////////////////////////////////////////////////
// SCRAPING SYSTEM
//////////////////////////////////////////////////////////

async function scrapeData(){

const topics=[
"Consciousness","Surveillance",
"Signal processing","Neural network",
"Dream","Hypnosis","Memory",
"Psychological operations"
];

const topic=topics[Math.floor(Math.random()*topics.length)];

try{
const res=await fetch(
"https://en.wikipedia.org/api/rest_v1/page/summary/"+topic
);
const data=await res.json();
scrapedText=data.extract;
}catch{
scrapedText="ARCHIVAL CORRUPTION DETECTED.";
}

scrapedImage.src=
"https://source.unsplash.com/800x600/?"+topic+"&sig="+Math.random();

}

//////////////////////////////////////////////////////////
// AUDIO ENGINE (ALL AUDIO ROUTED INTO RECORDING)
//////////////////////////////////////////////////////////

function setupAudio(){

audioCtx=new (window.AudioContext||window.webkitAudioContext)();
mediaDest=audioCtx.createMediaStreamDestination();

const masterGain=audioCtx.createGain();
masterGain.gain.value=0.8;

masterGain.connect(mediaDest);
masterGain.connect(audioCtx.destination);

// deep drone
const drone=audioCtx.createOscillator();
const droneGain=audioCtx.createGain();

drone.type="sine";
drone.frequency.value=33;
droneGain.gain.value=0.15;

drone.connect(droneGain);
droneGain.connect(masterGain);

drone.start();

// noise layer
const buffer=audioCtx.createBuffer(1,44100*2,44100);
const data=buffer.getChannelData(0);
for(let i=0;i<data.length;i++)
data[i]=Math.random()*2-1;

const noise=audioCtx.createBufferSource();
noise.buffer=buffer;
noise.loop=true;

const noiseGain=audioCtx.createGain();
noiseGain.gain.value=0.02;

noise.connect(noiseGain);
noiseGain.connect(masterGain);
noise.start();

return mediaDest.stream;
}

function jumpscare(){

const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();

osc.type="sawtooth";
osc.frequency.setValueAtTime(800,audioCtx.currentTime);
osc.frequency.exponentialRampToValueAtTime(40,audioCtx.currentTime+.2);

gain.gain.setValueAtTime(1,audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.3);

osc.connect(gain);
gain.connect(mediaDest);
gain.connect(audioCtx.destination);

osc.start();
osc.stop(audioCtx.currentTime+.3);

}

//////////////////////////////////////////////////////////
// BROADCAST VISUAL SYSTEM
//////////////////////////////////////////////////////////

function drawTemplate(){

ctx.fillStyle="#001020";
ctx.fillRect(0,0,1280,720);

ctx.strokeStyle="white";
ctx.strokeRect(40,40,1200,640);

ctx.font="40px Courier New";
ctx.fillText("EMERGENCY BROADCAST SYSTEM",80,120);

ctx.font="20px Courier New";

wrap(scrapedText,80,200,1000,28);

if(scrapedImage.complete){
ctx.globalAlpha=.35;
ctx.drawImage(scrapedImage,700,300,450,300);
ctx.globalAlpha=1;
}

drawTechnicalOverlay();

}

function drawTechnicalOverlay(){

ctx.font="14px Courier New";

ctx.fillText("SIGNAL ID: "+signalID,80,670);
ctx.fillText("FRAME: "+frame,350,670);
ctx.fillText("CHAPTER: "+chapter,500,670);
ctx.fillText("CHECKSUM: "+
(Math.random().toString(16).slice(2,10)),700,670);

ctx.strokeStyle="rgba(255,255,255,.2)";
ctx.beginPath();
for(let i=0;i<1280;i+=20)
ctx.lineTo(i,360+Math.sin(i*.01+frame*.02)*20);
ctx.stroke();

}

function drawEntity(){

ctx.fillStyle="white";
ctx.fillRect(0,0,1280,720);

ctx.fillStyle="black";
ctx.font="120px Courier New";
ctx.fillText("IT SEES YOU",150,380);

}

//////////////////////////////////////////////////////////
// GLITCH SYSTEM
//////////////////////////////////////////////////////////

function glitchFrame(){

const sliceY=Math.random()*700;
const sliceH=20+Math.random()*100;

ctx.drawImage(
canvas,
0,sliceY,1280,sliceH,
Math.random()*20-10,
sliceY,
1280,
sliceH
);

}

//////////////////////////////////////////////////////////
// TEXT WRAP
//////////////////////////////////////////////////////////

function wrap(text,x,y,max,lineHeight){

const words=text.split(" ");
let line="";

for(let n=0;n<words.length;n++){
const test=line+words[n]+" ";
if(ctx.measureText(test).width>max){
ctx.fillText(line,x,y);
line=words[n]+" ";
y+=lineHeight;
}else line=test;
}
ctx.fillText(line,x,y);
}

//////////////////////////////////////////////////////////
// MAIN LOOP
//////////////////////////////////////////////////////////

function loop(){

if(!running)return;

frame++;
document.getElementById("progress").style.width=
(frame/2400*100)+"%";

if(frame%600===0){
chapter++;
scrapeData();
}

if(Math.random()>.995){
glitch=true;
jumpscare();
}

if(glitch){
drawEntity();
if(Math.random()>.8)glitch=false;
}else{
drawTemplate();
if(Math.random()>.9)glitchFrame();
}

if(frame<2400)
requestAnimationFrame(loop);
else stop();

}

//////////////////////////////////////////////////////////
// START
//////////////////////////////////////////////////////////

async function start(){

document.getElementById("overlay").style.display="none";

await scrapeData();

const audioStream=setupAudio();
const canvasStream=canvas.captureStream(60);

const combined=new MediaStream([
...canvasStream.getVideoTracks(),
...audioStream.getAudioTracks()
]);

let mimeType="video/webm;codecs=vp9,opus";

if(!MediaRecorder.isTypeSupported(mimeType))
mimeType="video/webm;codecs=vp8,opus";

recorder=new MediaRecorder(combined,{mimeType});

chunks=[];

recorder.ondataavailable=e=>{
if(e.data.size>0)chunks.push(e.data);
};

recorder.onstop=save;

recorder.start();

running=true;
loop();

}

//////////////////////////////////////////////////////////
// STOP
//////////////////////////////////////////////////////////

function stop(){
running=false;
recorder.stop();
}

//////////////////////////////////////////////////////////
// SAVE
//////////////////////////////////////////////////////////

function save(){

const blob=new Blob(chunks,{type:recorder.mimeType});
const url=URL.createObjectURL(blob);

const a=document.createElement("a");
a.href=url;
a.download="SEPHIROTH_V7_"+Date.now()+".webm";
a.click();

}

</script>
</body>
</html>

