<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SEPHIROTH_V8 // COGNITIVE CONTAMINATION</title>

<style>

body{
margin:0;
background:black;
color:white;
font-family:Courier New;
overflow:hidden;
}

canvas{
width:100vw;
height:100vh;
background:black;
}

#overlay{
position:absolute;
width:100%;
height:100%;
background:black;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
z-index:10;
}

button{
padding:20px 50px;
background:black;
color:white;
border:1px solid white;
letter-spacing:4px;
cursor:pointer;
}

#progress{
position:absolute;
bottom:0;
height:4px;
background:red;
width:0%;
}

</style>
</head>
<body>

<div id="overlay">
<h2>DEPARTMENT OF ETHEREAL SAFETY</h2>
<p>COGNITIVE HAZARD TRAINING TAPE</p>
<button onclick="start()">BEGIN RECOVERY</button>
</div>

<canvas id="c" width="1280" height="720"></canvas>
<div id="progress"></div>

<script>

//////////////////////////////////////////////////////////
// BRAIN SYSTEM â€” MASSIVE KEYWORD SPACE
//////////////////////////////////////////////////////////

function generateKeyword(){

const syllables=[
"ka","zu","mi","ra","ta","shi","no","ve","di","an",
"tor","ul","mon","fer","zen","phi","crypt","void",
"psy","neuro","xen","ether","som","noct","omn",
"sig","mem","cog","echo","delta","omega","proto"
];

let word="";

const length=3+Math.floor(Math.random()*5);

for(let i=0;i<length;i++)
word+=syllables[Math.floor(Math.random()*syllables.length)];

return word;

}

const BRAIN={
seed:Math.random(),
keyword:generateKeyword(),
mood:Math.random(),
danger:Math.random()
};

//////////////////////////////////////////////////////////
// GLOBAL STATE
//////////////////////////////////////////////////////////

const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");

let audioCtx;
let mediaDest;
let recorder;
let chunks=[];
let frame=0;
let running=false;

let scrapedTexts=[];
let scrapedImages=[];

let glitchState=0;

//////////////////////////////////////////////////////////
// SCRAPING SYSTEM
//////////////////////////////////////////////////////////

async function scrapeText(){

try{

const res=await fetch(
"https://en.wikipedia.org/api/rest_v1/page/summary/"+BRAIN.keyword
);

const data=await res.json();

if(data.extract)
scrapedTexts.push(data.extract);

}catch{}

try{

const res=await fetch(
"https://api.duckduckgo.com/?q="+BRAIN.keyword+"&format=json"
);

const data=await res.json();

if(data.AbstractText)
scrapedTexts.push(data.AbstractText);

}catch{}

}

function scrapeImage(){

const img=new Image();

img.src=
"https://source.unsplash.com/800x600/?"+
BRAIN.keyword+
"&sig="+Math.random();

scrapedImages.push(img);

}

//////////////////////////////////////////////////////////
// AUDIO SYSTEM
//////////////////////////////////////////////////////////

function setupAudio(){

audioCtx=new AudioContext();

mediaDest=audioCtx.createMediaStreamDestination();

const master=audioCtx.createGain();
master.connect(mediaDest);
master.connect(audioCtx.destination);

const drone=audioCtx.createOscillator();
drone.frequency.value=30+(BRAIN.mood*50);

const droneGain=audioCtx.createGain();
droneGain.gain.value=0.2;

drone.connect(droneGain);
droneGain.connect(master);

drone.start();

const noiseBuffer=audioCtx.createBuffer(1,44100*2,44100);
const data=noiseBuffer.getChannelData(0);

for(let i=0;i<data.length;i++)
data[i]=Math.random()*2-1;

const noise=audioCtx.createBufferSource();
noise.buffer=noiseBuffer;
noise.loop=true;

const noiseGain=audioCtx.createGain();
noiseGain.gain.value=.03;

noise.connect(noiseGain);
noiseGain.connect(master);
noise.start();

return mediaDest.stream;

}

function glitchSound(){

const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();

osc.frequency.value=200+(Math.random()*2000);

gain.gain.value=.8;

osc.connect(gain);
gain.connect(mediaDest);
gain.connect(audioCtx.destination);

osc.start();
osc.stop(audioCtx.currentTime+.2);

}

//////////////////////////////////////////////////////////
// VISUAL SYSTEM
//////////////////////////////////////////////////////////

function drawPSA(){

ctx.fillStyle="#000010";
ctx.fillRect(0,0,1280,720);

ctx.strokeStyle="white";
ctx.strokeRect(50,50,1180,620);

ctx.font="40px Courier New";

ctx.fillText(
"COGNITIVE HAZARD WARNING",
80,
120
);

ctx.font="20px Courier New";

let y=200;

for(let text of scrapedTexts){

wrap(text,80,y,1000,28);

y+=120;

}

for(let img of scrapedImages){

if(img.complete){

ctx.globalAlpha=.3;

ctx.drawImage(img,700,200,450,300);

ctx.globalAlpha=1;

}

}

drawOverlay();

}

function drawOverlay(){

ctx.font="14px Courier New";

ctx.fillText("KEYWORD: "+BRAIN.keyword,80,680);

ctx.fillText("TIME: "+frame,300,680);

ctx.fillText("SIGNAL INTEGRITY: "+
Math.floor(Math.random()*100)+"%",500,680);

ctx.fillText("COGNITIVE LOAD: "+
Math.floor(BRAIN.danger*100)+"%",800,680);

}

function drawEntity(){

ctx.fillStyle="white";
ctx.fillRect(0,0,1280,720);

ctx.fillStyle="black";

ctx.font="100px Courier New";

ctx.fillText("THE FIEND",200,360);

}

function drawScanlines(){

ctx.globalAlpha=.2;

for(let y=0;y<720;y+=4){

ctx.fillRect(0,y,1280,2);

}

ctx.globalAlpha=1;

}

//////////////////////////////////////////////////////////
// TEXT WRAP
//////////////////////////////////////////////////////////

function wrap(text,x,y,max,lineHeight){

const words=text.split(" ");

let line="";

for(let w of words){

const test=line+w+" ";

if(ctx.measureText(test).width>max){

ctx.fillText(line,x,y);

line=w+" ";

y+=lineHeight;

}else line=test;

}

ctx.fillText(line,x,y);

}

//////////////////////////////////////////////////////////
// LOOP
//////////////////////////////////////////////////////////

function loop(){

if(!running)return;

frame++;

document.getElementById("progress").style.width=
(frame/3600*100)+"%";

if(Math.random()>.995){

glitchState=1;

glitchSound();

}

if(glitchState){

drawEntity();

if(Math.random()>.9)
glitchState=0;

}else{

drawPSA();

drawScanlines();

}

if(frame<3600)
requestAnimationFrame(loop);
else stop();

}

//////////////////////////////////////////////////////////
// START
//////////////////////////////////////////////////////////

async function start(){

document.getElementById("overlay").style.display="none";

await scrapeText();

scrapeImage();

const audio=setupAudio();

const canvasStream=canvas.captureStream(60);

const combined=new MediaStream([
...canvasStream.getVideoTracks(),
...audio.getAudioTracks()
]);

recorder=new MediaRecorder(combined);

recorder.ondataavailable=e=>{
if(e.data.size>0)
chunks.push(e.data);
};

recorder.onstop=save;

recorder.start();

running=true;

loop();

}

//////////////////////////////////////////////////////////
// STOP
//////////////////////////////////////////////////////////

function stop(){

running=false;

recorder.stop();

}

//////////////////////////////////////////////////////////
// SAVE
//////////////////////////////////////////////////////////

function save(){

const blob=new Blob(chunks);

const url=URL.createObjectURL(blob);

const a=document.createElement("a");

a.href=url;

a.download="SEPHIROTH_V8_"+BRAIN.keyword+".webm";

a.click();

}

</script>
</body>
</html>

