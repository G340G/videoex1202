<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>D.E.S // EMERGENCY BROADCAST</title>

<style>
body {
  margin:0;
  background:black;
  color:white;
  font-family:Courier New;
  overflow:hidden;
}

canvas {
  width:100vw;
  height:100vh;
}

#overlay{
position:absolute;
width:100%;
height:100%;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
background:black;
z-index:10;
}

button{
padding:20px 40px;
background:black;
color:white;
border:1px solid white;
cursor:pointer;
}

#progressbar{
position:absolute;
bottom:0;
height:5px;
background:red;
width:0%;
}
</style>
</head>
<body>

<div id="overlay">
<h2>DEPARTMENT OF ETHEREAL SAFETY</h2>
<button onclick="start()">INITIATE SIGNAL RECOVERY</button>
</div>

<canvas id="c" width="1280" height="720"></canvas>
<div id="progressbar"></div>

<script>

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let audioCtx;
let recorder;
let chunks=[];
let frame=0;
let recording=false;
let scrapedText="INITIALIZING DATABASE...";
let glitchFrame=false;

//////////////////////////////////////////////////////////
// SCRAPE REAL TEXT FROM WIKIPEDIA API
//////////////////////////////////////////////////////////

async function scrape(){

try{

const topics=["Psychology","Signal processing","Memory","Perception","Surveillance","Neural network","Dream"];

const topic=topics[Math.floor(Math.random()*topics.length)];

const res=await fetch(
"https://en.wikipedia.org/api/rest_v1/page/summary/"+topic
);

const data=await res.json();

scrapedText=data.extract;

}catch{

scrapedText="DATA CORRUPTION DETECTED";

}

}

//////////////////////////////////////////////////////////
// AUDIO ENGINE
//////////////////////////////////////////////////////////

function setupAudio(){

audioCtx=new AudioContext();

const dest=audioCtx.createMediaStreamDestination();

const drone=audioCtx.createOscillator();
const gain=audioCtx.createGain();

drone.frequency.value=37;
gain.gain.value=0.1;

drone.connect(gain);
gain.connect(dest);
gain.connect(audioCtx.destination);

drone.start();

return dest.stream;

}

function jumpscareSound(){

const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();

osc.frequency.value=800;
gain.gain.value=1;

osc.connect(gain);
gain.connect(audioCtx.destination);

osc.start();
osc.stop(audioCtx.currentTime+.2);

}

//////////////////////////////////////////////////////////
// PROFESSIONAL PSA TEMPLATE
//////////////////////////////////////////////////////////

function drawPSA(){

ctx.fillStyle="#001122";
ctx.fillRect(0,0,1280,720);

ctx.strokeStyle="white";
ctx.strokeRect(50,50,1180,620);

ctx.font="40px Courier New";
ctx.fillText("EMERGENCY BROADCAST SYSTEM",80,120);

ctx.font="20px Courier New";

wrapText(scrapedText,80,200,1000,30);

ctx.font="15px Courier New";

ctx.fillText("SIGNAL ID: "+Math.random().toString(16).slice(2),80,650);

ctx.fillText("FRAME: "+frame,400,650);

ctx.fillText("STATUS: ACTIVE",600,650);

}

//////////////////////////////////////////////////////////
// ENTITY JUMPSCARE
//////////////////////////////////////////////////////////

function drawJumpscare(){

ctx.fillStyle="white";
ctx.fillRect(0,0,1280,720);

ctx.fillStyle="black";
ctx.font="120px Courier New";
ctx.fillText("LOOK AT IT",200,400);

}

//////////////////////////////////////////////////////////
// TEXT WRAP
//////////////////////////////////////////////////////////

function wrapText(text,x,y,maxWidth,lineHeight){

const words=text.split(" ");
let line="";

for(let n=0;n<words.length;n++){

const testLine=line+words[n]+" ";

const metrics=ctx.measureText(testLine);

if(metrics.width>maxWidth){

ctx.fillText(line,x,y);

line=words[n]+" ";

y+=lineHeight;

}else{

line=testLine;

}

}

ctx.fillText(line,x,y);

}

//////////////////////////////////////////////////////////
// MAIN RENDER LOOP
//////////////////////////////////////////////////////////

function render(){

if(!recording)return;

frame++;

document.getElementById("progressbar").style.width=
(frame/1800*100)+"%";

if(Math.random()>.995){

glitchFrame=true;

jumpscareSound();

}

if(glitchFrame){

drawJumpscare();

if(Math.random()>.9)glitchFrame=false;

}else{

drawPSA();

}

if(frame<1800){

requestAnimationFrame(render);

}else{

stop();

}

}

//////////////////////////////////////////////////////////
// RECORD
//////////////////////////////////////////////////////////

function start(){

document.getElementById("overlay").style.display="none";

scrape();

const audio=setupAudio();

const stream=canvas.captureStream(60);

const combined=new MediaStream([
...stream.getTracks(),
...audio.getTracks()
]);

recorder=new MediaRecorder(combined);

recorder.ondataavailable=e=>chunks.push(e.data);

recorder.onstop=save;

recorder.start();

recording=true;

render();

}

//////////////////////////////////////////////////////////
// STOP
//////////////////////////////////////////////////////////

function stop(){

recording=false;

recorder.stop();

}

//////////////////////////////////////////////////////////
// SAVE
//////////////////////////////////////////////////////////

function save(){

const blob=new Blob(chunks,{type:"video/webm"});

const url=URL.createObjectURL(blob);

const a=document.createElement("a");

a.href=url;

a.download="DES_RECOVERY_"+Date.now()+".webm";

a.click();

}

</script>
</body>
</html>


