<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SEPHIROTH_V5 // GENERATIVE_VOID</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: "Courier New", monospace; }
        #master-container { position: relative; width: 100vw; height: 100vh; }
        canvas { width: 100%; height: 100%; display: block; image-rendering: pixelated; }
        
        /* UI Elements */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        #start-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #050505; z-index: 100; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; color: #f00; cursor: crosshair; 
        }
        #rec-indicator { 
            position: absolute; top: 30px; left: 30px; color: red; font-weight: bold; 
            display: none; text-shadow: 0 0 10px red; font-size: 20px; 
        }
        
        /* VHS Overlay Effect */
        .vhs-lines {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 5; background-size: 100% 3px, 3px 100%; pointer-events: none;
        }

        .terminal-text {
            position: absolute; bottom: 40px; left: 40px; color: #fff; background: #000;
            padding: 5px 15px; font-size: 18px; max-width: 60%; display: none;
        }

        button { 
            background: transparent; border: 1px solid #f00; color: #f00; 
            padding: 20px 40px; font-family: inherit; font-size: 20px; 
            letter-spacing: 5px; cursor: pointer; transition: 0.3s;
        }
        button:hover { background: #f00; color: #000; box-shadow: 0 0 20px #f00; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="margin-bottom: 40px; letter-spacing: 15px;">PROJ_SEPHIROTH</h1>
        <button id="init-btn">GENERATE & RECORD SEQUENCE</button>
        <p style="margin-top: 20px; font-size: 12px; opacity: 0.5;">[30 SECOND CAPTURE // AUTO-DOWNLOAD]</p>
    </div>

    <div id="master-container">
        <canvas id="mainCanvas"></canvas>
        <div id="ui-layer">
            <div id="rec-indicator">‚óè REC</div>
            <div id="caption" class="terminal-text"></div>
            <div class="vhs-lines"></div>
        </div>
    </div>

<script>
/**
 * PROJECT SEPHIROTH V5: GENERATIVE HORROR ENGINE
 * Features: Procedural Mayan Mask, Theme Scraping, WebAudio FM Synthesis, MediaRecorder.
 */

const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
const startScreen = document.getElementById('start-screen');
const caption = document.getElementById('caption');
const recLabel = document.getElementById('rec-indicator');

canvas.width = 1280;
canvas.height = 720;

// --- THEME ENGINE ---
const THEMES = [
    { 
        name: "THE_ROOT", 
        keywords: "roots,dirt,underground,veins", 
        color: "#221100", 
        msg: ["THE TREE IS THIRSTY", "DIGGING IN SECTOR 7", "REPLACE THE SOIL", "ROOT_PENETRATION_SUCCESS"] 
    },
    { 
        name: "THE_SKY", 
        keywords: "astronomy,void,telescope,clouds", 
        color: "#000022", 
        msg: ["THE STARS ARE TEETH", "DO NOT LOOK UP", "THE SUN IS LOUD", "VACUUM_BREATHING_STATED"] 
    },
    { 
        name: "THE_FLESH", 
        keywords: "anatomy,meat,medical,texture", 
        color: "#330000", 
        msg: ["UPGRADE YOUR SKIN", "THE VEINS ARE WIRES", "BONE_DENSITY_LOW", "BLOOD_SIGNAL_CLEAN"] 
    }
];

let sessionTheme = THEMES[Math.floor(Math.random() * THEMES.length)];
let audioCtx, masterGain, recorder, chunks = [];
let frame = 0;
let isHorror = false;
let scrapedImg = new Image();

// --- AUDIO SYNTHESIS ---
function initAudio() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.connect(audioCtx.destination);
}

function playTone(freq, dur, type='sine', vol=0.1) {
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    g.gain.setValueAtTime(vol, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    osc.connect(g).connect(masterGain);
    osc.start();
    osc.stop(audioCtx.currentTime + dur);
}

// --- DRAWING THE FIEND (Mayan Mask) ---
function drawFiend() {
    ctx.save();
    ctx.translate(canvas.width / 2, canvas.height / 2);
    
    // Face shape
    ctx.fillStyle = "#111";
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 4;
    
    ctx.beginPath();
    ctx.moveTo(-150, -200);
    ctx.lineTo(150, -200);
    ctx.lineTo(180, 100);
    ctx.lineTo(0, 250);
    ctx.lineTo(-180, 100);
    ctx.close();
    ctx.fill();
    ctx.stroke();

    // Geometric details
    ctx.beginPath();
    ctx.moveTo(-150, -100); ctx.lineTo(150, -100);
    ctx.moveTo(-100, 0); ctx.lineTo(100, 0);
    ctx.stroke();

    // The Eyes
    const flicker = Math.random() > 0.9 ? 1 : 0.4;
    ctx.fillStyle = `rgba(255, 255, 255, ${flicker})`;
    ctx.shadowBlur = 20;
    ctx.shadowColor = "white";
    ctx.fillRect(-80, -150, 40, 15);
    ctx.fillRect(40, -150, 40, 15);
    
    // Mouth
    ctx.fillStyle = "#000";
    ctx.fillRect(-60, 50, 120, 60);
    ctx.strokeStyle = "#555";
    for(let i=-60; i<=60; i+=20) {
        ctx.strokeRect(i, 50, 1, 60);
    }
    
    ctx.restore();
}

// --- MAIN LOOP ---
function render() {
    frame++;
    
    // 30 second limit (60fps * 30 = 1800)
    if (frame > 1800) {
        stopSequence();
        return;
    }

    ctx.fillStyle = "#000";
    ctx.fillRect(0,0, canvas.width, canvas.height);

    // Toggle between PPT and Horror randomly
    if (frame % 300 === 0) {
        isHorror = Math.random() > 0.5;
        if (isHorror) {
            caption.style.display = 'block';
            caption.innerText = sessionTheme.msg[Math.floor(Math.random() * sessionTheme.msg.length)];
            playTone(60, 2, 'sawtooth', 0.2);
            speak(caption.innerText);
        } else {
            caption.style.display = 'none';
        }
    }

    if (!isHorror) {
        // PPT MODE
        ctx.fillStyle = "#e0e0e0";
        ctx.fillRect(50, 50, canvas.width - 100, canvas.height - 100);
        ctx.fillStyle = "#000080";
        ctx.font = "bold 60px 'Arial'";
        ctx.fillText(`TOPIC: ${sessionTheme.name}`, 100, 150);
        ctx.font = "30px 'Arial'";
        ctx.fillText("- Observations on Growth", 100, 220);
        ctx.fillText("- Quarterly Disappearance Metrics", 100, 270);
        
        // Illogical Zooming Image
        if (scrapedImg.complete) {
            ctx.drawImage(scrapedImg, 700, 200, 400 + Math.sin(frame*0.05)*50, 300);
        }
    } else {
        // HORROR MODE
        if (Math.random() > 0.95) { // Jumpscare Flash
            ctx.fillStyle = "#fff";
            ctx.fillRect(0,0, canvas.width, canvas.height);
            playTone(Math.random()*1000 + 100, 0.1, 'square', 0.5);
        }
        drawFiend();
        
        // Glitch lines
        ctx.strokeStyle = "red";
        ctx.lineWidth = 1;
        for(let i=0; i<5; i++) {
            let y = Math.random() * canvas.height;
            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
        }
    }

    requestAnimationFrame(render);
}

// --- UTILS ---
function speak(text) {
    const synth = window.speechSynthesis;
    const utter = new SpeechSynthesisUtterance(text);
    utter.pitch = 0.1;
    utter.rate = 0.7;
    synth.speak(utter);
}

function startRecording() {
    const stream = canvas.captureStream(30);
    recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `VOID_SIGNAL_${sessionTheme.name}.webm`;
        a.click();
    };
    recorder.start();
    recLabel.style.display = 'block';
}

function stopSequence() {
    recorder.stop();
    recLabel.style.display = 'none';
    alert("TRANSMISSION COMPLETE. VIDEO DOWNLOADED.");
}

// --- INITIALIZE ---
document.getElementById('init-btn').addEventListener('click', () => {
    startScreen.style.display = 'none';
    initAudio();
    scrapedImg.src = `https://picsum.photos/800/600?grayscale&t=${Date.now()}`;
    
    // Background drone
    setInterval(() => {
        if(!isHorror) playTone(110, 4, 'sine', 0.05);
        else playTone(55, 1, 'sawtooth', 0.1);
    }, 2000);

    startRecording();
    render();
});

</script>
</body>
</html>
